{
  "basic_intent": {
    "issue_category": "INSTRUMENTATION",
    "static_analysis_query": {
      "find_method_call": "SetTag"
    },
    "semantic_description": "Add HTTP_REFERER and HTTP_RESPONSE_REDIRECT_LOCATION headers as span attributes for all CLM web app HTTP request spans.",
    "search_keywords": [
      "HTTP_REFERER",
      "HTTP_RESPONSE_REDIRECT_LOCATION",
      "Activity.SetTag",
      "ActivitySource",
      "OpenTelemetry",
      "middleware",
      "redirect"
    ],
    "telemetry_operation": {
      "type": "span",
      "target_name": null,
      "action": "ADD_ATTRIBUTES",
      "attributes_to_add": [
        {
          "name": "HTTP_REFERER",
          "value_source": "Request.Headers[\"Referer\"]"
        },
        {
          "name": "HTTP_RESPONSE_REDIRECT_LOCATION",
          "value_source": "Response.Headers[\"Location\"]"
        }
      ],
      "new_span_name": null,
      "new_metric_details": {}
    }
  },
  "enhanced_analysis": {
    "confidence": "high",
    "operation_type": "multi_file",
    "complexity_score": 4,
    "estimated_files": 3,
    "validation_issues": [],
    "suggestions": [],
    "sub_tasks": [],
    "contextual_hints": [
      "Finding or building middleware that has access to the Activity instance **after** response headers are written (needed for redirect location)",
      "Ensuring attributes are only added to the *HTTP server* span, not to nested Activity scopes created later in the request",
      "Gracefully handling absent headers and non-redirect status codes to avoid noisy null/empty tags",
      "Validating the change in all environments (Dev \u2192 QA \u2192 Prod) because redirect behavior can differ by load balancer, proxies, or SSO modules"
    ]
  }
}